<section class="welcome-section">
  <div class="welcome-container">
    <div class="nav-container">
      <button class="button" (click)="sendToHome($event)">
        <div class="button-box">
          <span class="button-elem">
            <svg viewBox="0 0 46 40" xmlns="http://www.w3.org/2000/svg">
              <path d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"></path>
            </svg>
          </span>
          <span class="button-elem">
            <svg viewBox="0 0 46 40">
              <path d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"></path>
            </svg>
          </span>
        </div>
      </button>
    </div>

    <div class="title-container">
      <h1 class="title-front">
        <span *ngIf="nombreCurso">{{ nombreCurso }} 🚀</span>
        <span *ngIf="!nombreCurso">Módulos del Curso 🚀</span>
      </h1>
    </div>

    <p class="frontend-description" *ngIf="curso">
      {{ curso.descripcion }}
    </p>
    
    <p class="frontend-description" *ngIf="!curso">
      Aquí encontrarás todos los módulos del curso seleccionado. Cada módulo está diseñado para 
      ayudarte a avanzar paso a paso en tu aprendizaje, con contenido estructurado y ejemplos prácticos.
    </p>

    <div class="tech-cards-container" *ngIf="curso">
      <app-card-tecnology [title]="curso.tecnologia"></app-card-tecnology>
      <app-card-tecnology [title]="curso.nivel"></app-card-tecnology>
      <app-card-tecnology [title]="curso.duracion"></app-card-tecnology>
    </div>
  </div>
</section>

<div class="navbar-container">
  <div class="search-bar">
    <div class="InputContainer">
      <svg class="searchIcon" width="20px" viewBox="0 0 24 24" height="20px" xmlns="http://www.w3.org/2000/svg">
        <path fill="none" d="M0 0h24v24H0z"></path>
        <path d="M15.5 14h-.79l-.28-.27A6.518 6.518 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
      </svg>
      <input #searchInput class="input" id="search-input" placeholder="Buscar módulos..." type="text"/>
    </div>
    <div class="border"></div>
    <button aria-label="Voice search" class="micButton" (click)="toggleVoiceRecognition()" [class.listening]="isListening">
      <svg width="20px" viewBox="0 0 384 512" height="20px" class="micIcon" xmlns="http://www.w3.org/2000/svg">
        <path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"></path>
      </svg>
    </button>
  </div>
  
  <button class="btn-add" (click)="openModal()">
    <div class="svg-wrapper-1">
      <div class="svg-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="icon">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" fill="currentColor"/>
        </svg>
      </div>
    </div>
    <span>Agregar Módulo</span>
  </button>
</div>

<div *ngIf="cargando" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Cargando módulos...</p>
</div>

<div class="modulos-container" *ngIf="!cargando">
  <div class="card-row">
    @for (modulo of filteredModulos; track modulo.id) {
      <app-card-module-dashboard
        [imageUrl]="modulo.imagen_portada"
        [title]="modulo.titulo"
        [description]="modulo.descripcion"
        [moduloId]="modulo.id"
        (cardClick)="navigateToModuleDetail($event)">
      </app-card-module-dashboard>
    }
    @empty {
      <div class="card-alert">
        <span>
          <svg viewBox="0 0 576 512" xmlns="http://www.w3.org/2000/svg">
            <path
              d="m569.517 440.013c18.458 31.994-4.711 71.987-41.577 71.987h-479.886c-36.937 0-59.999-40.055-41.577-71.987l239.946-416.028c18.467-32.009 64.72-31.951 83.154 0zm-281.517-86.013c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"
            ></path>
          </svg>
          <p>
            <span *ngIf="cursoId && filteredModulos.length === 0 && modulos.length > 0">
              No se encontraron módulos que coincidan con tu búsqueda
            </span>
            <span *ngIf="!cursoId">
              No se ha seleccionado ningún curso
            </span>
            <span *ngIf="cursoId && modulos.length === 0">
              Este curso aún no tiene módulos disponibles
            </span>
          </p>
        </span>
      </div>
    }
  </div>
  <div class="social">
      <app-redes-sociales></app-redes-sociales>
  </div>
</div>

<app-chatbot></app-chatbot>

<app-tecnologias></app-tecnologias>

<!-- Modal Agregar Módulo -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-content add-course-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title-section">
        <div class="modal-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" fill="currentColor"/>
          </svg>
        </div>
        <h2>Crear Nuevo Módulo</h2>
      </div>
      <button class="modal-close" (click)="closeModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="onSubmit()" class="modal-form">
        <div class="form-section">
          <h3 class="section-title">Información Básica</h3>
          
          <div class="form-group">
            <label for="titulo">Título del Módulo <span class="required">*</span></label>
            <div class="input-wrapper">
              <input 
                type="text" 
                id="titulo" 
                [(ngModel)]="nuevoModulo.titulo" 
                name="titulo" 
                required
                class="form-input"
                placeholder="Ej: Configuración de puertos en AWS">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="imagen_portada">URL de la Imagen de Portada <span class="required">*</span></label>
            <div class="input-wrapper">
              <input 
                type="url" 
                id="imagen_portada" 
                [(ngModel)]="nuevoModulo.imagen_portada" 
                name="imagen_portada" 
                required
                class="form-input"
                placeholder="https://ejemplo.com/imagen-del-modulo.jpg">
              <div class="input-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                  <polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Contenido</h3>
          
          <div class="form-group">
            <label for="descripcion">Descripción del Módulo <span class="required">*</span></label>
            <div class="textarea-wrapper">
              <textarea 
                id="descripcion" 
                [(ngModel)]="nuevoModulo.descripcion" 
                name="descripcion" 
                required
                rows="4"
                class="form-textarea"
                placeholder="Describe el contenido y objetivos de aprendizaje de este módulo..."></textarea>
              <div class="textarea-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8L14 2Z" stroke="currentColor" stroke-width="2"/>
                  <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                  <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                  <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                  <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-save" 
            [disabled]="!isValidForm() || isSaving">
            <div class="btn-content">
              <div class="btn-spinner" *ngIf="isSaving">
                <div class="spinner-mini"></div>
              </div>
              <svg *ngIf="!isSaving" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H16L21 8V19A2 2 0 0 1 19 21Z" stroke="currentColor" stroke-width="2"/>
                <polyline points="17,21 17,13 7,13 7,21" stroke="currentColor" stroke-width="2"/>
                <polyline points="7,3 7,8 15,8" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>{{ isSaving ? 'Creando Módulo...' : 'Crear Módulo' }}</span>
            </div>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de Éxito -->
<div class="modal-overlay success-overlay" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
  <div class="modal-content success-modal" (click)="$event.stopPropagation()">
    <div class="modal-body">
      <div class="success-content">
        <div class="success-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 11.08V12A10 10 0 1 1 5.93 7.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>¡Módulo Creado Exitosamente!</h2>
        <p>El módulo ha sido agregado correctamente al curso. Los estudiantes ya pueden acceder a su contenido.</p>
        
        <div class="success-actions">
          <button class="btn-success-primary" (click)="closeSuccessModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polyline points="9,11 12,14 22,4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21,12V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3H16" stroke="currentColor" stroke-width="2"/>
            </svg>
            Perfecto
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Error -->
<div class="modal-overlay error-overlay" *ngIf="showErrorModal" (click)="closeErrorModal()">
  <div class="modal-content error-modal" (click)="$event.stopPropagation()">
    <div class="modal-body">
      <div class="error-content">
        <div class="error-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
            <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <h2>Oops! Algo salió mal</h2>
        <p>{{ errorMessage || 'Ha ocurrido un error inesperado. Por favor, verifica los datos e intenta nuevamente.' }}</p>
        
        <div class="error-actions">
          <button class="btn-error-secondary" (click)="closeErrorModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Cerrar
          </button>
          <button class="btn-error-primary" (click)="recargarModulos()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20.49,15A9,9,0,1,1,5.64,5.64L23,10" stroke="currentColor" stroke-width="2"/>
            </svg>
            Reintentar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>