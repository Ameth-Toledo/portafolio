<section class="home">
  <div class="header">
    <h1 class="text">Cursos</h1>
    <div class="header-right">
      <div class="search-section">
        <div class="search-bar">
          <div class="InputContainer">
            <svg class="searchIcon" width="20px" viewBox="0 0 24 24" height="20px" xmlns="http://www.w3.org/2000/svg">
              <path fill="none" d="M0 0h24v24H0z"></path>
              <path d="M15.5 14h-.79l-.28-.27A6.518 6.518 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
            </svg>
            <input class="input" id="search-input" placeholder="Buscar cursos por nombre" type="text" [(ngModel)]="terminoBusqueda" (input)="onBuscar()"/>
          </div>
          <div class="border"></div>
          <button aria-label="Voice search" class="micButton" (click)="toggleVoiceRecognition()" [class.listening]="isListening">
            <svg width="20px" viewBox="0 0 384 512" height="20px" class="micIcon" xmlns="http://www.w3.org/2000/svg">
              <path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"></path>
            </svg>
          </button>
          <button *ngIf="terminoBusqueda" class="clearButton" (click)="limpiarBusqueda()" aria-label="Limpiar búsqueda">
            <svg width="16px" height="16px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <button class="btn-add" (click)="openModal()">
        <div class="svg-wrapper-1">
          <div class="svg-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="icon">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" fill="currentColor"/>
            </svg>
          </div>
        </div>
        <span>Agregar Curso</span>
      </button>
    </div>
  </div>

  <div class="search-results-info" *ngIf="terminoBusqueda">
    <p>Mostrando {{ cursosFiltrados.length }} de {{ cursos.length }} cursos para "<strong>{{ terminoBusqueda }}</strong>"</p>
  </div>

  <div class="cards-grid" *ngIf="!isLoading">  
    <app-card-curso-dashboard
      *ngFor="let curso of cursosFiltrados"
      [id]="curso.id"
      [nombre]="curso.nombre"
      [descripcion]="curso.descripcion"
      [nivel]="curso.nivel"
      [duracion]="curso.duracion"
      [tecnologia]="curso.tecnologia"
      [fecha]="curso.fecha"
      [imagen]="curso.imagen"
      (editarCurso)="openEditModal(curso)"
      (eliminarCurso)="eliminarCurso(curso.id)">
    </app-card-curso-dashboard>
  </div>

  <div class="no-results" *ngIf="!isLoading && cursosFiltrados.length === 0 && terminoBusqueda">
    <div class="no-results-content">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.5 14h-.79l-.28-.27A6.518 6.518 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#94a3b8"/>
      </svg>
      <h3>No se encontraron cursos</h3>
      <p>No hay cursos que coincidan con tu búsqueda "<strong>{{ terminoBusqueda }}</strong>"</p>
      <button class="btn-clear-search" (click)="limpiarBusqueda()">
        Ver todos los cursos
      </button>
    </div>
  </div>

  <div class="loading" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Cargando cursos...</p>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
    <div class="modal-content add-course-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-section">
          <div class="modal-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" fill="currentColor"/>
            </svg>
          </div>
          <h2>{{ isEditMode ? 'Editar Curso' : 'Crear Nuevo Curso' }}</h2>
        </div>
        <button class="modal-close" (click)="closeModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="onSubmit()" class="modal-form" #cursoForm="ngForm">
          <div class="form-section">
            <h3 class="section-title">Información Básica</h3>
            
            <div class="form-group">
              <label for="nombre">Nombre del Curso <span class="required">*</span></label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="nombre" 
                  [(ngModel)]="curso.nombre" 
                  name="nombre" 
                  required
                  class="form-input"
                  placeholder="Ej: Desarrollo Web con React"
                  #nombreInput="ngModel">
                <div class="input-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="nivel">Nivel de Dificultad <span class="required">*</span></label>
                <div class="select-wrapper">
                  <select 
                    id="nivel" 
                    [(ngModel)]="curso.nivel" 
                    name="nivel" 
                    required
                    class="form-select"
                    #nivelSelect="ngModel">
                    <option value="" disabled>Selecciona un nivel</option>
                    <option *ngFor="let nivelOption of niveles" [value]="nivelOption">{{ nivelOption }}</option>
                  </select>
                  <div class="select-arrow">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="tecnologia">Tecnología Principal <span class="required">*</span></label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    id="tecnologia" 
                    [(ngModel)]="curso.tecnologia" 
                    name="tecnologia" 
                    required
                    class="form-input"
                    placeholder="Ej: React.js, Python, Node.js"
                    #tecnologiaInput="ngModel">
                  <div class="input-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="12,2 15.09,8.26 22,9 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9 8.91,8.26" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="duracion">Duración del Curso <span class="required">*</span></label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    id="duracion" 
                    [(ngModel)]="curso.duracion" 
                    name="duracion" 
                    required
                    class="form-input"
                    placeholder="Ej: 8 semanas, 40 horas"
                    #duracionInput="ngModel">
                  <div class="input-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="fecha">Fecha de Inicio <span class="required">*</span></label>
                <div class="input-wrapper">
                  <input 
                    type="text" 
                    id="fecha" 
                    [(ngModel)]="curso.fecha" 
                    name="fecha" 
                    required
                    class="form-input"
                    placeholder="Ej: 15 de Septiembre 2025"
                    #fechaInput="ngModel">
                  <div class="input-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                      <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                      <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                      <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-title">Contenido y Recursos</h3>
            
            <div class="form-group">
              <label for="imagen">URL de la Imagen de Portada <span class="required">*</span></label>
              <div class="input-wrapper">
                <input 
                  type="url" 
                  id="imagen" 
                  [(ngModel)]="curso.imagen" 
                  name="imagen" 
                  required
                  class="form-input"
                  placeholder="https://ejemplo.com/imagen-del-curso.jpg"
                  #imagenInput="ngModel">
                <div class="input-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                    <polyline points="21,15 16,10 5,21" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="descripcion">Descripción del Curso <span class="required">*</span></label>
              <div class="textarea-wrapper">
                <textarea 
                  id="descripcion" 
                  [(ngModel)]="curso.descripcion" 
                  name="descripcion" 
                  required
                  rows="4"
                  class="form-textarea"
                  placeholder="Describe el contenido, objetivos de aprendizaje y lo que los estudiantes lograrán al completar este curso..."
                  #descripcionTextarea="ngModel"></textarea>
                <div class="textarea-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8L14 2Z" stroke="currentColor" stroke-width="2"/>
                    <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                    <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                    <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                    <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-cancel" (click)="closeModal()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cancelar
            </button>
            <button 
              type="submit" 
              class="btn-save" 
              [disabled]="!cursoForm.valid || isSaving">
              <div class="btn-content">
                <div class="btn-spinner" *ngIf="isSaving">
                  <div class="spinner-mini"></div>
                </div>
                <svg *ngIf="!isSaving" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H16L21 8V19A2 2 0 0 1 19 21Z" stroke="currentColor" stroke-width="2"/>
                  <polyline points="17,21 17,13 7,13 7,21" stroke="currentColor" stroke-width="2"/>
                  <polyline points="7,3 7,8 15,8" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>{{ isSaving ? (isEditMode ? 'Actualizando...' : 'Creando Curso...') : (isEditMode ? 'Actualizar Curso' : 'Crear Curso') }}</span>
              </div>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal-overlay success-overlay" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
    <div class="modal-content success-modal" (click)="$event.stopPropagation()">
      <div class="modal-body">
        <div class="success-content">
          <div class="success-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 11.08V12A10 10 0 1 1 5.93 7.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h2>¡Curso {{ isEditMode ? 'Actualizado' : 'Creado' }} Exitosamente!</h2>
          <p>El curso ha sido {{ isEditMode ? 'actualizado' : 'agregado' }} correctamente a la plataforma.</p>
          
          <div class="success-actions">
            <button class="btn-success-primary" (click)="closeSuccessModal()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <polyline points="9,11 12,14 22,4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21,12V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3H16" stroke="currentColor" stroke-width="2"/>
              </svg>
              Perfecto
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay error-overlay" *ngIf="showErrorModal" (click)="closeErrorModal()">
    <div class="modal-content error-modal" (click)="$event.stopPropagation()">
      <div class="modal-body">
        <div class="error-content">
          <div class="error-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
              <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <h2>Oops! Algo salió mal</h2>
          <p>{{ errorMessage || 'Ha ocurrido un error inesperado. Por favor, verifica los datos e intenta nuevamente.' }}</p>
          
          <div class="error-actions">
            <button class="btn-error-secondary" (click)="closeErrorModal()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cerrar
            </button>
            <button class="btn-error-primary" (click)="closeErrorModal(); cargarCursos()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.49,15A9,9,0,1,1,5.64,5.64L23,10" stroke="currentColor" stroke-width="2"/>
              </svg>
              Reintentar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>